name: check

on:
  push:
    branches:
      - "**"
    paths:
      - ".github/workflows/check.yml"
      - "assets/**"
      - "**.py"
  pull_request:
    branches:
      - "**"
    paths:
      - ".github/workflows/check.yml"
      - "assets/**"
      - "**.py"
  workflow_dispatch:

jobs:
  resource:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Install maafw: dynamically read version/spec from requirements.txt and install that
      - name: Install maafw (from requirements.txt)
        shell: powershell
        run: |
          python -m pip install --upgrade pip
          # 在 requirements.txt 中查找以 maafw 开头的行（例如: maafw==5.1.0 或 maafw>=4.5）
          $line = Get-Content requirements.txt | Where-Object { $_ -match '^\s*maafw' } | Select-Object -First 1
          if ($line) {
            $pkg = $line.Trim()
          } else {
            $pkg = 'maafw'
          }
          Write-Host "Installing $pkg"
          python -m pip install --upgrade $pkg

      - name: Check Resource
        run: |
            python ./tools/ci/check_resource.py ./assets/resource/base/ ./assets/resource/bilibili/ ./assets/resource/global_en/ ./assets/resource/global_jp/
